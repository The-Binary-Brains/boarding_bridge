<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="/css/student_reg.css" />
        <link rel="icon" href="/images/favicon.png" type="image/icon type" />
        <title>Student Registration</title>
    </head>

    <body>
        <div class="header">
            <span class="title">Boarding Bridge</span>
        </div>
        <div class="form_section">
            <div class="form_title">Registration</div>
            <div class="form_line"></div>
            <div class="form_header form_padding">
                <div class="form_sub_title">Welcome to Boarding Bridge</div>
                <div class="form_info">
                    <strong>Note:</strong> You must be a currently enrolled
                    student at Sri Jayawardenapura University to access and use
                    the system and services offered by Boarding Bridge.
                </div>
            </div>
            <div class="form_container form_padding">
                <form id="registrationForm">
                    <div class="input">
                        <input
                            id="userName"
                            placeholder="User Name"
                            type="text"
                            name="userName"
                            required
                        />
                        <label for="userName"
                            >User name is used for login process</label
                        >
                    </div>
                    <div class="input">
                        <input
                            id="email"
                            placeholder="Email"
                            type="email"
                            name="email"
                            required
                        />
                        <label for="email"
                            >Email that is used by the Boarding Bridge to
                            contact you</label
                        >
                    </div>
                    <div class="input">
                        <input
                            id="password"
                            placeholder="Password"
                            type="password"
                            name="password"
                            required
                        />
                        <label for="password" id="password_label"
                            >Please provide a strong password</label
                        >
                    </div>
                    <div class="input">
                        <input
                            id="confirmPassword"
                            placeholder="Confirm Password"
                            type="password"
                            required
                        />
                        <label for="confirmPassword" id="confirm_password_label"
                            >confirm entered password above</label
                        >
                    </div>

                    <div class="input">
                        <div class="checkbox">
                            <input id="terms" type="checkbox" required />
                            <label for="terms"
                                >I agree to the
                                <a href="#">[Terms & Conditions]</a> and<a
                                    href="#"
                                >
                                    [Privacy Policy]</a
                                ></label
                            >
                        </div>
                    </div>
                    <div class="input">
                        <button id="submitBtn" type="submit">Register</button>
                    </div>
                    <div class="form_line"></div>
                    <p class="post-note">
                        Already have an account?
                        <a href="http://localhost:5000/student/page/login"
                            ><i>Log In</i></a
                        >
                    </p>
                </form>
            </div>
        </div>
        <footer>
            <div class="Center">
                <div class="logo">
                    <div class="title">Boarding Bridge</div>
                    <div class="sub_title">
                        "Connecting Students with Quality Accommodations"
                    </div>
                    <p>
                        Phone : +94 01 457 8546 <br />
                        Email : support@boardingbridge.lk <br />
                        Address: 123 Campus Dr., City
                    </p>
                </div>
            </div>
            <div class="bottom">
                <div class="bottom_line"></div>
                <span class="rights"
                    >Â© 2024 BoardingBridge. All rights reserved.</span
                >
            </div>
        </footer>
        <div class="overlay" id="overlay">
            <div class="content" id="overlayContent"></div>
        </div>
    </body>
    <script src="/js/student_reg_validation.js" type="module"></script>
    <script>
        const overlay = document.getElementById("overlay");
        const overlayContentHTML = document.getElementById("overlayContent");

        const loadingHTML = `
<div class="loading" id="loading">
<div class="spinner"></div>
<div class="loading-text" id="loadingText">Please Wait...</div>
</div>
`;

        const registrationSuccess = ` Registeration compleate! <br> You will be redirected to the login page..`;

        const handlePaymet = async () => {
            overlayContentHTML.innerHTML = loadingHTML;

            const formElement = document.getElementById("registrationForm");
            const formData = new FormData(formElement);

            const formJSON = Object.fromEntries(formData.entries());

            try {
                const response = await fetch(
                    `http://localhost:5000/student/api/register`,
                    {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify(formJSON),
                    }
                );

                const result = await response.json();
                console.log(result);

                const data = await response.json();

                overlayContentHTML.innerHTML = registrationSuccess;

                setTimeout(() => {
                    window.location.href =
                        "http://localhost:5000/student/page/login";
                }, 2000);
            } catch (error) {
                overlayContentHTML.innerHTML =
                    "Error submitting data, please try again.";
                console.error("Error:", error);
            }
        };

        const handleFormSubmission = async (event) => {
            event.preventDefault();

            overlay.style.display = "flex";
            document.body.style.overflow = "hidden";
            overlayContentHTML.innerHTML = loadingHTML;

            handlePaymet();
        };

        registrationForm.addEventListener("submit", handleFormSubmission);

        const loginForm = document.getElementById("registrationForm");
        const error = document.getElementById("error");

        const handleUserFormSubmission = async (event) => {
            event.preventDefault();

            const formData = new FormData(loginForm);

            try {
                const formDataObj = Object.fromEntries(formData.entries());
                const jsonFormData = JSON.stringify(formDataObj);

                const response = await fetch(
                    `http://localhost:5000/student/api/login`,
                    {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: jsonFormData,
                    }
                );

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                console.log("login success:", result);
                if (result == "success") {
                } else {
                    error.style.display = "block";
                }
            } catch (error) {
                console.error("Error editing property:", error);
                error.style.display = "block";
                error.style.innerText = "Something went wrong!";
            }
        };

        loginForm.addEventListener("submit", handleUserFormSubmission);
    </script>
</html>
